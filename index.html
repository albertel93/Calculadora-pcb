<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">
  <title>Calculadora de Inserción</title>
  <style>
    :root{
      --bg:#0f1115;--panel:#161a22;--ink:#e8edf2;--muted:#b0b8c6;--border:#2a2f3a;
      --accent:#6ee7b7;--ink2:#cfe0ff;
    }
    *{box-sizing:border-box}
    body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--ink);margin:0;padding:18px}
    .shell{max-width:1000px;margin:0 auto}
    header{display:flex;align-items:center;gap:14px;margin-bottom:14px}
    header img{height:36px;width:auto;border-radius:6px;background:#0b0f16}
    header h1{margin:0;font-size:20px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px}
    h2{margin:0 0 10px 0;font-size:18px}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width:900px){ .row{grid-template-columns:1fr 1fr} }
    .group{border:1px solid var(--border);border-radius:12px;padding:12px}
    .group h3{margin:0 0 10px 0;font-size:14px;color:#c9d1dd}
    .inputs2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .field{display:flex;flex-direction:column}
    .label{font-size:12px;letter-spacing:.4px;color:#c9d1dd;margin-bottom:6px;text-transform:uppercase}
    input{
      width:100%;height:46px;padding:10px 12px;border-radius:10px;border:1px solid #394153;
      background:#0b0f16;color:var(--ink);font-size:16px;outline:none;
    }
    input::placeholder{color:#6f7a8f}
    .kpi{display:flex;justify-content:space-between;gap:12px;padding:12px;border:1px dashed #2a3241;border-radius:10px;margin:8px 0;font-variant-numeric:tabular-nums}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    button{height:44px;padding:0 14px;border-radius:10px;border:1px solid #233049;background:#0b1020;color:var(--ink2);font-weight:700;cursor:pointer}
    #calcBtn{background:linear-gradient(135deg,#6ee7b7,#7dd3fc);color:#0b1020;border:0}
    #pdfBtn{background:#1b2436}
    .note{color:var(--muted);font-size:12px;margin-top:8px}

    #printSheet{display:none}
    #printSheet .sheet{
      width:210mm; min-height:297mm; padding:18mm; background:#fff; color:#111; 
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    }
    #printSheet header{display:flex;align-items:center;gap:14px;margin-bottom:8mm}
    #printSheet header img{height:30px;width:auto}
    #printSheet h2{font-size:20px;margin:0}
    #printSheet .sub{color:#555;margin-top:2px;font-size:12px}
    #printSheet table{width:100%;border-collapse:collapse;margin-top:6mm;font-size:14px}
    #printSheet th, #printSheet td{border:1px solid #ddd;padding:10px;text-align:left}
    #printSheet th{background:#f4f6f9}
    #printSheet .total{font-weight:700}
    @media print{
      body{padding:0;background:#fff}
      .app{display:none}
      #printSheet{display:block}
      @page{size:A4;margin:12mm}
    }
  </style>
</head>
<body>
  <div class="shell app">
    <header>
      <img id="logo" src="https://time-group.es/wp-content/uploads/2024/05/cropped-timegroup-logo.png" alt="Logo">
      <h1>Calculadora de Inserción</h1>
    </header>

    <div class="card">
      <h2>Entradas</h2>
      <!-- aquí irían tus inputs como antes -->
    </div>

    <div class="card">
      <h2>Resultados (solo en € · sin IVA)</h2>
      <div class="kpi"><span>Coste TOP por placa</span><span id="topPerBoard">—</span></div>
      <div class="kpi"><span>Coste BOTTOM por placa</span><span id="botPerBoard">—</span></div>
      <div class="kpi"><span>Coste SMD por placa</span><span id="smdPerBoard">—</span></div>
      <div class="kpi"><strong>Total por placa</strong><strong id="totalPerBoard">—</strong></div>
      <div class="kpi"><strong>Total del lote</strong><strong id="totalLot">—</strong></div>
    </div>

    <div class="actions">
      <button id="calcBtn" type="button" onclick="calc()">Calcular</button>
      <button id="pdfBtn" type="button" onclick="exportPDF()">Exportar PDF</button>
      <button id="resetBtn" type="button" onclick="resetAll()">Reset</button>
    </div>
  </div>

  <!-- Hoja PDF oculta -->
  <div id="printSheet">
    <div class="sheet">
      <header>
        <img id="pLogo" src="https://time-group.es/wp-content/uploads/2024/05/cropped-timegroup-logo.png" alt="Logo">
        <div>
          <h2>Resumen de coste de inserción</h2>
          <div class="sub" id="pDate"></div>
        </div>
      </header>
      <table>
        <thead><tr><th>Concepto</th><th>Valor</th></tr></thead>
        <tbody>
          <tr><td>Nº componentes TOP por placa</td><td id="pTopCount">—</td></tr>
          <tr><td>Nº componentes BOTTOM por placa</td><td id="pBotCount">—</td></tr>
          <tr><td>Nº componentes SMD por placa</td><td id="pSmdCount">—</td></tr>
          <tr class="total"><td>Coste por unidad de placa (sin IVA)</td><td id="pCostPerUnit">—</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    var LOGO_URL = "https://time-group.es/wp-content/uploads/2024/05/cropped-timegroup-logo.png";
    var EUR_TO_PTAS = 166.386;
    var syncing = false;

    function num(v){ if (typeof v!=="string") v=String(v??""); v=v.replace(',', '.').replace(/[^0-9.\-]/g,''); var n=parseFloat(v); return isFinite(n)?n:0; }
    function fmtEUR(v){ v=Math.round(v*10000)/10000; return "€ "+v.toFixed(4); }

    function syncPair(base,from){
      if(syncing) return;
      syncing=true;
      var eurInput=document.getElementById(base+"EUR");
      var ptaInput=document.getElementById(base+"PTA");
      if(from==="EUR"){
        var eur=num(eurInput.value);
        var pta=eur*EUR_TO_PTAS;
        ptaInput.value=eurInput.value===""?"":(Math.round(pta*100)/100).toFixed(2);
      } else {
        var pta2=num(ptaInput.value);
        var eur2=pta2/EUR_TO_PTAS;
        eurInput.value=ptaInput.value===""?"":(Math.round(eur2*10000)/10000).toFixed(4);
      }
      syncing=false;
    }

    function calc(){
      syncPair('top','EUR'); syncPair('bot','EUR'); syncPair('smd','EUR');
      var qty=num(document.getElementById("qty")?.value);
      var topCount=num(document.getElementById("topCount")?.value);
      var botCount=num(document.getElementById("botCount")?.value);
      var smdCount=num(document.getElementById("smdCount")?.value);
      var topEUR=num(document.getElementById("topEUR")?.value);
      var botEUR=num(document.getElementById("botEUR")?.value);
      var smdEUR=num(document.getElementById("smdEUR")?.value);
      var top=topCount*topEUR, bot=botCount*botEUR, smd=smdCount*smdEUR;
      var total=top+bot+smd, lot=total*qty;
      document.getElementById("topPerBoard").textContent=fmtEUR(top);
      document.getElementById("botPerBoard").textContent=fmtEUR(bot);
      document.getElementById("smdPerBoard").textContent=fmtEUR(smd);
      document.getElementById("totalPerBoard").textContent=fmtEUR(total);
      document.getElementById("totalLot").textContent=fmtEUR(lot);
    }

    function resetAll(){
      ["qty","topCount","botCount","smdCount","topEUR","topPTA","botEUR","botPTA","smdEUR","smdPTA"]
      .forEach(id=>{var el=document.getElementById(id); if(el) el.value="";});
      ["topPerBoard","botPerBoard","smdPerBoard","totalPerBoard","totalLot"]
      .forEach(id=>document.getElementById(id).textContent="—");
    }

    function exportPDF(){
      calc();
      document.getElementById("pLogo").src=LOGO_URL;
      var now=new Date();
      var fecha=now.toLocaleDateString('es-ES')+" "+now.toLocaleTimeString('es-ES',{hour:'2-digit',minute:'2-digit'});
      document.getElementById("pDate").textContent="Generado: "+fecha;
      document.getElementById("pTopCount").textContent=document.getElementById("topCount")?.value||"—";
      document.getElementById("pBotCount").textContent=document.getElementById("botCount")?.value||"—";
      document.getElementById("pSmdCount").textContent=document.getElementById("smdCount")?.value||"—";
      document.getElementById("pCostPerUnit").textContent=document.getElementById("totalPerBoard")?.textContent||"—";
      window.print();
    }
  </script>
</body>
</html>
